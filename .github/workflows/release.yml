name: Release

# Evento que dispara o workflow
on:
  push:
    branches:
      - main           # Executa quando houver push na branch main
    tags:
      - 'v*.*.*'       # Executa também quando uma tag que segue o padrão de versão for criada (ex: v1.0.0)

jobs:
  release:
    name: Changelog & GitHub Release
    runs-on: ubuntu-latest  # Ambiente que executa a job

    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4   # Faz checkout do código da branch/tag atual

      - name: 🧪 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18          # Define a versão do Node.js para rodar os comandos

      - name: 📦 Install dependencies
        run: npm ci                # Instala as dependências de forma limpa e rápida

      - name: 🚀 Run standard-version to bump version and generate changelog
        run: npx standard-version  # Executa o standard-version para atualizar versão e gerar changelog

      - name: 🔥 Push changes and tags
        run: |
          git push --follow-tags origin main  # Envia os commits e tags gerados para o GitHub

      - name: 🏷️ Create GitHub release
        uses: ncipollo/release-action@v1     # Cria uma release no GitHub automaticamente
        with:
          tag: ${{ github.ref_name }}        # Usa a tag que disparou o workflow para a release
